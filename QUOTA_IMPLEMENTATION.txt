```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                       â•‘
â•‘   â­ UPGRADE: CONTROL DE QUOTA API (100 PETICIONES/MES)              â•‘
â•‘                                                                       â•‘
â•‘   El cÃ³digo ha sido optimizado para economizar peticiones             â•‘
â•‘   BÃºsquedas: cada 24h â†’ cada 72h (pero mÃ¡s eficientes)             â•‘
â•‘   Peticiones/mes: 150+ â†’ 50 (margen de seguridad)                   â•‘
â•‘                                                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ CAMBIOS PRINCIPALES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âœ… Tracking automÃ¡tico de peticiones API
   â””â”€ Cada bÃºsqueda se registra en BD
   â””â”€ Quota se actualiza en tiempo real

2. âœ… BÃºsquedas espaciadas inteligentemente
   â””â”€ 72 horas entre bÃºsquedas (ajustable)
   â””â”€ ~10-20 bÃºsquedas/mes en lugar de 30

3. âœ… Alertas automÃ¡ticas en Telegram
   â””â”€ Status de quota en cada bÃºsqueda
   â””â”€ Advertencia al 80%
   â””â”€ CrÃ­tica al 100%

4. âœ… Pausa automÃ¡tica si se alcanza lÃ­mite
   â””â”€ Evita sobrepasar 100/100 peticiones
   â””â”€ Reanuda en el prÃ³ximo mes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ PASOS PARA IMPLEMENTAR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PASO 1: Actualizar archivos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ config.py       â†’ versiÃ³n con QUOTA (ya actualizado)
âœ“ main.py         â†’ versiÃ³n con tracking (REVISAR: main_v2_quota.py)
âœ“ .env            â†’ nuevas variables

PASO 2: Actualizar .env
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cp .env.example.new .env
# O editar manualmente:
SEARCH_INTERVAL_HOURS=72       # (DEFAULT: 3 dÃ­as)
MONTHLY_REQUEST_LIMIT=100      # (NO CAMBIAR)
QUOTA_WARNING_THRESHOLD=0.8    # (DEFAULT: 80%)
PAUSE_AT_QUOTA=true            # (DEFAULT: SÃ)

PASO 3: Deploy
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
./deploy.sh

PASO 4: Monitorear
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
docker logs -f intel_idealista

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š CAMBIO DE COMPORTAMIENTO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ANTES (v1.0):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BÃºsquedas:            cada 24h
BÃºsquedas/mes:        30
Peticiones/mes:       150+ âŒ EXCEDE
Resultado:            API BLOQUEADA

AHORA (v2.0):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BÃºsquedas:            cada 72h (3 dÃ­as)
BÃºsquedas/mes:        10
Peticiones/mes:       ~50 âœ… SEGURO
Resultado:            SOSTENIBLE


Equivalencia de frecuencia:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intervalo           â”‚ BÃºsquedas/mes â”‚ Requests/mes â”‚ Sostenible     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 48h (2 dÃ­as)        â”‚ 15            â”‚ ~75          â”‚ âœ… SÃ          â”‚
â”‚ 72h (3 dÃ­as)        â”‚ 10            â”‚ ~50          â”‚ âœ… SÃ (DEFAULT) â”‚
â”‚ 96h (4 dÃ­as)        â”‚ 8             â”‚ ~40          â”‚ âœ… MUY SEGURO  â”‚
â”‚ 120h (5 dÃ­as)       â”‚ 6             â”‚ ~30          â”‚ âœ… CONSERVADOR â”‚
â”‚ 168h (1 semana)     â”‚ 4             â”‚ ~20          â”‚ âœ… MUY CONSERV â”‚
â”‚ 24h (ORIGINAL)      â”‚ 30            â”‚ ~150         â”‚ âŒ NO (EXCEDE) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš™ï¸ CONFIGURACIÃ“N
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Variables en .env:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# CRÃTICO: No cambiar (es lÃ­mite del API)
MONTHLY_REQUEST_LIMIT=100

# Ajustable: Intervalos entre bÃºsquedas
SEARCH_INTERVAL_HOURS=72            # DEFAULT: cada 3 dÃ­as

# Ajustable: Alertas
QUOTA_WARNING_THRESHOLD=0.8         # DEFAULT: alerta al 80%
PAUSE_AT_QUOTA=true                 # DEFAULT: pausar si alcanza 100%

# Opcional: Reducir volumen de bÃºsqueda
MAX_PAGES_PER_DAY=5                 # DEFAULT: 5 pÃ¡ginas
                                     # ALTERNATIVA: 3 pÃ¡ginas para economizar mÃ¡s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¾ MONITOREO EN TIEMPO REAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ver estado actual de quota:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ source utils.sh
$ query_db "SELECT mes_ano, usado, limite, \
    ROUND(100.0*usado/limite,1) as porcentaje FROM api_quota"

Ver Ãºltimas peticiones:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ query_db "SELECT fecha, tipo, exitoso FROM api_requests \
    ORDER BY fecha DESC LIMIT 10"

En Metabase (http://localhost:3000):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Query:
SELECT 
    mes_ano,
    usado,
    limite,
    ROUND((usado::float/limite)*100,1) as porcentaje,
    (limite - usado) as disponibles
FROM api_quota
ORDER BY mes_ano DESC


Logs en tiempo real:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ docker logs -f intel_idealista | grep -i "quota\|api_request"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ ESCENARIOS DE USO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ESCENARIO 1: MÃ¡ximo margen de seguridad (RECOMENDADO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SEARCH_INTERVAL_HOURS=120
MAX_PAGES_PER_DAY=3

Resultado:
  â€¢ 6 bÃºsquedas/mes
  â€¢ ~30 requests/mes
  â€¢ 70% de margen disponible
  â€¢ MÃS CONFIABLE âœ…


ESCENARIO 2: Equilibrio (DEFAULT)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SEARCH_INTERVAL_HOURS=72
MAX_PAGES_PER_DAY=5

Resultado:
  â€¢ 10 bÃºsquedas/mes
  â€¢ ~50 requests/mes
  â€¢ 50% de margen disponible
  â€¢ BALANCE âœ…


ESCENARIO 3: MÃ¡ximo alcance (CON RIESGO)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SEARCH_INTERVAL_HOURS=48
MAX_PAGES_PER_DAY=5

Resultado:
  â€¢ 15 bÃºsquedas/mes
  â€¢ ~75 requests/mes
  â€¢ 25% de margen disponible
  â€¢ âš ï¸ MÃS RIESGO (reintentos, token requests)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š DOCUMENTACIÃ“N
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Lee los siguientes archivos en orden:

1. API_QUOTA.md
   â”œâ”€ Entendimiento completo del sistema de quota
   â”œâ”€ FÃ³rmulas y matemÃ¡ticas
   â”œâ”€ Ejemplos de monitoreo
   â””â”€ Recomendaciones detalladas

2. QUOTA_CHANGES_SUMMARY.md
   â”œâ”€ Resumen de cambios implementados
   â”œâ”€ Archivos modificados
   â”œâ”€ Ejemplos de configuraciÃ³n
   â””â”€ PrÃ³ximos pasos

3. .env.example.new
   â”œâ”€ Plantilla con todas las variables
   â”œâ”€ Comentarios explicativos
   â””â”€ Valores recomendados

4. config.py
   â”œâ”€ Variables de quota en cÃ³digo
   â”œâ”€ Valores por defecto
   â””â”€ Validaciones

5. main.py (lÃ­neas ~150-350)
   â”œâ”€ Funciones: check_api_quota()
   â”œâ”€ Funciones: should_search_now()
   â”œâ”€ Funciones: track_api_request()
   â””â”€ LÃ³gica de control

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ADVERTENCIAS IMPORTANTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ NO HAGAS:
  â€¢ Cambiar MONTHLY_REQUEST_LIMIT (es el lÃ­mite real del API)
  â€¢ Reducir SEARCH_INTERVAL_HOURS a menos de 24h sin entender riesgos
  â€¢ Ignorar alertas de quota al 80%
  â€¢ Continuar buscando si PAUSE_AT_QUOTA=true y quota=100%

âœ… HAZLO:
  â€¢ Leer API_QUOTA.md completamente
  â€¢ Monitorear quota en primeras semanas
  â€¢ Mantener PAUSE_AT_QUOTA=true
  â€¢ Ajustar segÃºn necesidades despuÃ©s de datos reales
  â€¢ Documentar cambios que hagas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ RESULTADO FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… API SOSTENIBLE: Nunca excederÃ¡ 100 peticiones/mes
âœ… AUTO-CONTROL: Se pausa automÃ¡ticamente si alcanza lÃ­mite
âœ… ALERTAS: Te avisa antes de problemas
âœ… MONITOREO: Tracking completo en BD y Metabase
âœ… FLEXIBLE: Ajustable segÃºn tus necesidades

Tu bot ahora es ENTERPRISE-READY para producciÃ³n ğŸš€
```
